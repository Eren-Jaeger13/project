<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试中心</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');

        :root {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --primary-color: #0f3460;
            --secondary-color: #e94560;
            --text-color: #e0e0e0;
            --light-text: #a0a0a0;
            --correct-color: #2ecc71;
            --incorrect-color: #e74c3c;
            --clicked-color: #3498db;
            --highlight-color: #f1c40f;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .container {
            background-color: var(--container-bg);
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 700px;
            text-align: center;
            border: 1px solid var(--primary-color);
        }

        h1,
        h2 {
            color: white;
            margin-bottom: 10px;
        }

        p {
            color: var(--light-text);
            line-height: 1.6;
        }

        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            background-color: #ff5a79;
        }

        .hide {
            display: none;
        }

        #question-container {
            text-align: left;
        }

        #question-text {
            font-size: 1.5rem;
            margin-bottom: 30px;
            text-align: center;
        }

        #answer-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .answer-btn {
            background-color: var(--primary-color);
            padding: 15px;
            font-size: 1rem;
            border: 2px solid transparent;
        }

        .answer-btn:hover {
            background-color: #1e4a8b;
        }

        .answer-btn.correct {
            background-color: var(--correct-color);
            color: white;
        }

        .answer-btn.incorrect {
            background-color: var(--incorrect-color);
            color: white;
        }

        .answer-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        #progress-bar-container {
            width: 100%;
            height: 10px;
            background-color: var(--primary-color);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--secondary-color);
            transition: width 0.4s ease;
        }

        #result-analysis {
            font-size: 1.2rem;
            font-weight: bold;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            color: white;
        }

        #test-center-container .btn-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        #shulte-grid {
            display: grid;
            gap: 5px;
            margin-top: 20px;
        }

        .shulte-cell {
            background-color: var(--primary-color);
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            color: white;
            cursor: pointer;
        }

        .shulte-cell:hover {
            background-color: #1e4a8b;
        }

        .shulte-cell.clicked {
            background-color: var(--clicked-color);
        }

        /* 新增色彩敏感测试样式 */
        #color-test-container {
            text-align: center;
        }

        #color-word {
            font-size: 3rem;
            margin: 30px 0;
            font-weight: bold;
        }

        #color-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .color-option {
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            color: white;
        }

        .color-option:hover {
            transform: translateY(-3px);
        }

        #color-timer {
            font-size: 1.5rem;
            margin: 10px 0;
            color: var(--secondary-color);
        }

        #color-difficulty-container {
            text-align: center;
        }

        #mot-container {
            position: relative;
            width: 400px;
            height: 400px;
            border: 1px solid var(--primary-color);
            margin: 20px auto;
        }

        .ball {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            transition: background-color 0.3s;
        }
    </style>
</head>

<body>

    <div id="main-container" class="container">
        <!-- 测试中心界面 -->
        <div id="test-center-container">
            <h1>测试中心</h1>
            <p>选择你想进行的测试：</p>
            <div class="btn-container">
                <button id="reaction-test-btn" class="btn">反应测试</button>
                <button id="iq-test-btn" class="btn">智商测试</button>
                <button id="focus-test-btn" class="btn">专注度测试</button>
                <button id="color-sensitivity-test-btn" class="btn">色彩敏感测试</button>
                <button id="eq-test-btn" class="btn">情商测试</button>
            </div>
            <!-- 返回主界面按钮 -->
            <button id="backToMainBtn" class="btn">返回主界面</button>
        </div>

        <!-- 反应测试难度选择界面 -->
        <div id="reaction-difficulty-container" class="hide">
            <h1>反应测试 - 选择难度</h1>
            <p>请选择舒尔特方格的难度：</p>
            <button id="3x3-btn" class="btn">3x3</button>
            <button id="4x4-btn" class="btn">4x4</button>
            <button id="5x5-btn" class="btn">5x5</button>
            <button id="6x6-btn" class="btn">6x6</button>
            <button id="back-to-test-center-btn" class="btn">返回测试中心</button>
        </div>

        <!-- 舒尔特方格测试界面 -->
        <div id="shulte-test-container" class="hide">
            <h1>反应测试 - 舒尔特方格</h1>
            <p id="shulte-instruction">请按数字从小到大的顺序点击</p>
            <div id="shulte-grid"></div>
            <p id="shulte-timer">用时：0.00 秒</p>
            <button id="shulte-back-to-difficulty-btn" class="btn">返回选择难度</button>
        </div>

        <!-- 答题界面 -->
        <div id="quiz-container" class="hide">
            <div id="question-header">
                <span id="question-counter">问题 1 / 10</span>
            </div>
            <div id="progress-bar-container">
                <div id="progress-bar"></div>
            </div>
            <h2 id="question-text">问题会显示在这里</h2>
            <div id="answer-buttons" class="btn-grid">
                <!-- 答案按钮将由JS动态生成 -->
            </div>
            <!-- 新增返回按钮 -->
            <button id="quiz-back-btn" class="btn">返回测试中心</button>
        </div>

        <!-- 色彩敏感测试难度选择界面 -->
        <div id="color-difficulty-container" class="hide">
            <h1>色彩敏感测试 - 选择难度</h1>
            <p>请选择测试难度：</p>
            <button id="color-easy-btn" class="btn">简单 (1.8秒/题)</button>
            <button id="color-medium-btn" class="btn">普通 (1.25秒/题)</button>
            <button id="color-hard-btn" class="btn">困难 (1.0秒/题)</button>
            <button id="color-back-to-test-center-btn" class="btn">返回测试中心</button>
        </div>

        <!-- 色彩敏感测试界面 -->
        <div id="color-test-container" class="hide">
            <div id="color-question-header">
                <span id="color-question-counter">问题 1 / 10</span>
            </div>
            <div id="color-progress-bar-container">
                <div id="color-progress-bar"></div>
            </div>
            <div id="color-word"></div>
            <div id="color-timer">1.8</div>
            <div id="color-options"></div>
            <button id="color-back-to-difficulty-btn" class="btn">返回选择难度</button>
        </div>

        <!-- 目标跟踪测试界面 -->
        <div id="mot-container" class="hide">
            <h1>专注度测试 - 目标跟踪</h1>
            <p>请记住高亮的小球，移动结束后选出这些小球。</p>
            <div id="mot-field" style="position: relative; width: 400px; height: 400px; border: 1px solid var(--primary-color); margin: 20px auto;"></div>
            <button id="mot-start-btn" class="btn">开始</button>
            <button id="mot-answer-btn" class="btn hide">提交答案</button>
            <button id="mot-back-to-test-center-btn" class="btn">返回测试中心</button>
        </div>

        <!-- 结果界面 -->
        <div id="result-container" class="hide">
            <h1>测试完成！</h1>
            <div id="test-specific-result"></div>
            <div id="result-analysis"></div>
            <button id="restart-btn" class="btn">再次挑战</button>
            <button id="back-btn" class="btn">返回主页</button>
        </div>
    </div>

    <script>
        const iqQuestions = [
            { question: "哪个数字不属于这个序列：2, 3, 6, 7, 14, 15, 30", options: ["7", "8", "14", "30"], answer: "8" },
            { question: "如果所有的“蓝波”都是“格兰”，而一些“格兰”是“斯派”，那么我们能确定什么？", options: ["所有蓝波都是斯派", "一些蓝波是斯派", "没有蓝波是斯派", "无法确定蓝波和斯派的关系"], answer: "无法确定蓝波和斯派的关系" },
            { question: "在3点15分时，时针和分针之间的夹角是多少度？", options: ["0度", "7.5度", "15度", "22.5度"], answer: "7.5度" },
            { question: "填入下一个数字：1, 4, 9, 16, 25, ?", options: ["32", "36", "49", "64"], answer: "36" },
            { question: "“医生”对于“病人”，就像“律师”对于？", options: ["法官", "法庭", "客户", "案件"], answer: "客户" },
            { question: "一个男孩有和他兄弟一样多的姐妹，但他的每个姐妹只有他兄弟数量一半的姐妹。这个家庭有多少个男孩和女孩？", options: ["2男3女", "3男2女", "4男3女", "3男4女"], answer: "4男3女" },
            { question: "如果昨天是后天的话，那么今天就是星期五了。那么真正的“今天”是星期几？", options: ["星期一", "星期三", "星期日", "星期五"], answer: "星期三" },
            { question: "在下列图形中，哪一个与其他三个最不相同？（想象四个图形：一个实心圆，一个实心正方形，一个实心三角形，一个空心圆）", options: ["实心圆", "实心正方形", "实心三角形", "空心圆"], answer: "空心圆" },
            { question: "你参加一场赛跑，你超过了第二名，那么你现在是第几名？", options: ["第一名", "第二名", "第三名", "无法确定"], answer: "第二名" }
        ];

        const eqQuestions = [
            { question: "当你遇到一个情绪激动的人时，你首先会做什么？", options: ["倾听他们的感受", "提供解决方案", "转移话题", "保持沉默"], answer: "倾听他们的感受" },
            { question: "如果你和朋友发生了争执，你会如何处理？", options: ["主动道歉，即使你认为自己没有错", "等待对方先道歉", "分析问题的根源并寻求解决方案", "暂时避开这个话题"], answer: "分析问题的根源并寻求解决方案" },
            { question: "当你感到压力很大时，你通常会怎么做？", options: ["与他人分享你的感受", "独自处理", "通过运动或其他活动释放压力", "试图忘记它并继续前进"], answer: "通过运动或其他活动释放压力" },
            { question: "如果你注意到同事看起来情绪低落，你会怎么做？", options: ["询问他们是否需要帮助", "保持距离，以免打扰他们", "告诉其他同事注意到了", "开个玩笑让他们感觉好点"], answer: "询问他们是否需要帮助" },
            { question: "当你必须做出一个困难的决定时，你会考虑哪些因素？", options: ["逻辑和理性", "他人的感受和需求", "自己的直觉", "所有这些因素"], answer: "所有这些因素" },
            { question: "如果你在团队中工作，而团队成员之间存在冲突，你会怎么做？", options: ["保持中立，不参与", "帮助调解冲突", "支持你认为正确的一方", "向上级报告问题"], answer: "帮助调解冲突" },
            { question: "当你收到批评时，你会如何反应？", options: [" defensive并试图解释", "接受并努力改进", "忽略它", "感到沮丧并停止尝试"], answer: "接受并努力改进" },
            { question: "如果你需要给某人一个负面反馈，你会怎么做？", options: ["直接和诚实地表达", "委婉地表达", "避免给出负面反馈", "先表扬，然后给出反馈"], answer: "先表扬，然后给出反馈" },
            { question: "当你感到愤怒时，你通常会怎么做？", options: ["表达你的愤怒", "抑制你的愤怒", "找到健康的方式来释放它", "将它转向自己"], answer: "找到健康的方式来释放它" },
            { question: "你如何处理工作中的变化和不确定性？", options: ["感到焦虑并难以适应", "接受并尝试适应", "忽略它并继续做你正在做的事情", "寻找机会从中学习"], answer: "寻找机会从中学习" }
        ];

        // 色彩敏感测试相关变量
        const colorNames = ["红色", "绿色", "蓝色", "黄色", "紫色", "橙色"];
        const colorHex = {
            "红色": "#e74c3c",
            "绿色": "#2ecc71",
            "蓝色": "#3498db",
            "黄色": "#f1c40f",
            "紫色": "#9b59b6",
            "橙色": "#e67e22"
        };

        const testCenterContainer = document.getElementById('test-center-container');
        const reactionDifficultyContainer = document.getElementById('reaction-difficulty-container');
        const shulteTestContainer = document.getElementById('shulte-test-container');
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const reactionTestBtn = document.getElementById('reaction-test-btn');
        const iqTestBtn = document.getElementById('iq-test-btn');
        const focusTestBtn = document.getElementById('focus-test-btn');
        const colorSensitivityTestBtn = document.getElementById('color-sensitivity-test-btn');
        const eqTestBtn = document.getElementById('eq-test-btn');
        const restartBtn = document.getElementById('restart-btn');
        const backBtn = document.getElementById('back-btn');
        const questionTextEl = document.getElementById('question-text');
        const answerButtonsEl = document.getElementById('answer-buttons');
        const questionCounterEl = document.getElementById('question-counter');
        const progressBar = document.getElementById('progress-bar');
        const testSpecificResultEl = document.getElementById('test-specific-result');
        const resultAnalysisEl = document.getElementById('result-analysis');
        const backToMainBtn = document.getElementById('backToMainBtn');
        const backToTestCenterBtn = document.getElementById('back-to-test-center-btn');
        const shulteBackToDifficultyBtn = document.getElementById('shulte-back-to-difficulty-btn');
        const shulteGrid = document.getElementById('shulte-grid');
        const shulteTimer = document.getElementById('shulte-timer');

        // 色彩敏感测试相关元素
        const colorDifficultyContainer = document.getElementById('color-difficulty-container');
        const colorTestContainer = document.getElementById('color-test-container');
        const colorWordEl = document.getElementById('color-word');
        const colorOptionsEl = document.getElementById('color-options');
        const colorTimerEl = document.getElementById('color-timer');
        const colorQuestionCounterEl = document.getElementById('color-question-counter');
        const colorProgressBar = document.getElementById('color-progress-bar');
        const colorEasyBtn = document.getElementById('color-easy-btn');
        const colorMediumBtn = document.getElementById('color-medium-btn');
        const colorHardBtn = document.getElementById('color-hard-btn');
        const colorBackToDifficultyBtn = document.getElementById('color-back-to-difficulty-btn');
        const colorBackToTestCenterBtn = document.getElementById('color-back-to-test-center-btn');

        // 目标跟踪测试相关元素
        const motContainer = document.getElementById('mot-container');
        const motField = document.getElementById('mot-field');
        const motStartBtn = document.getElementById('mot-start-btn');
        const motAnswerBtn = document.getElementById('mot-answer-btn');
        const motBackToTestCenterBtn = document.getElementById('mot-back-to-test-center-btn');

        let currentQuestionIndex, score, shuffledQuestions, currentTestType;
        let shulteNumbers, currentShulteIndex, shulteStartTime, shulteInterval;
        let currentTargetNumber = 1; // 当前应点击的目标数字

        // 色彩敏感测试相关变量
        let colorQuestions, currentColorQuestionIndex, colorScore, colorDifficulty, colorTimer, colorTimerInterval;
        const difficultyTimeLimit = {
            "easy": 1.8,
            "medium": 1.25,
            "hard": 1.0
        };

        // 目标跟踪测试相关变量
        let balls = [];
        let targetBalls = [];
        let selectedBalls = [];
        let motInterval;

        function startGame(testType) {
            if (testType === 'reaction') {
                testCenterContainer.classList.add('hide');
                reactionDifficultyContainer.classList.remove('hide');
            } else if (testType === 'color-sensitivity') {
                testCenterContainer.classList.add('hide');
                colorDifficultyContainer.classList.remove('hide');
            } else if (testType === 'focus') {
                testCenterContainer.classList.add('hide');
                motContainer.classList.remove('hide');
                currentTestType = testType;
                initMot();
            } else {
                testCenterContainer.classList.add('hide');
                resultContainer.classList.add('hide');
                quizContainer.classList.remove('hide');
                currentTestType = testType;
                switch (testType) {
                    case 'iq':
                        shuffledQuestions = iqQuestions.sort(() => Math.random() - 0.5);
                        break;
                    case 'eq':
                        shuffledQuestions = eqQuestions.sort(() => Math.random() - 0.5);
                        break;
                }
                currentQuestionIndex = 0;
                score = 0;
                setNextQuestion();
            }
        }

        function startShulteTest(size) {
            reactionDifficultyContainer.classList.add('hide');
            shulteTestContainer.classList.remove('hide');
            currentTestType = 'reaction';
            currentTargetNumber = 1;

            shulteNumbers = [];
            for (let i = 1; i <= size * size; i++) {
                shulteNumbers.push(i);
            }
            shulteNumbers.sort(() => Math.random() - 0.5);

            shulteGrid.innerHTML = '';
            shulteGrid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            shulteNumbers.forEach((number) => {
                const cell = document.createElement('button');
                cell.innerText = number;
                cell.classList.add('shulte-cell');
                cell.dataset.number = number;
                cell.addEventListener('click', () => checkShulteAnswer(cell));
                shulteGrid.appendChild(cell);
            });

            currentShulteIndex = 0;
            shulteStartTime = Date.now();
            shulteInterval = setInterval(updateShulteTimer, 10);
        }

        function checkShulteAnswer(cell) {
            const number = parseInt(cell.dataset.number);
            if (number === currentTargetNumber) {
                cell.classList.add('clicked');

                // 禁用已点击的方块
                cell.disabled = true;

                currentShulteIndex++;
                currentTargetNumber++;
                if (currentShulteIndex === shulteNumbers.length) {
                    clearInterval(shulteInterval);
                    const totalTime = (Date.now() - shulteStartTime) / 1000;
                    showShulteResult(totalTime);
                }
            }
        }

        function updateShulteTimer() {
            const currentTime = (Date.now() - shulteStartTime) / 1000;
            shulteTimer.innerText = `用时：${currentTime.toFixed(2)} 秒`;
        }

        function showShulteResult(totalTime) {
            shulteTestContainer.classList.add('hide');
            resultContainer.classList.remove('hide');

            // 显示反应测试结果
            const size = Math.sqrt(shulteNumbers.length);
            testSpecificResultEl.innerHTML = `<h2>完成 ${size}x${size} 舒尔特方格!</h2><p>你的用时：<strong>${totalTime.toFixed(2)}</strong> 秒</p>`;

            let analysisText, analysisColor;
            if (size === 3) {
                if (totalTime < 5) {
                    analysisText = '你的反应速度极快，简直像闪电一样！';
                    analysisColor = '#f1c40f';
                } else if (totalTime < 10) {
                    analysisText = '反应很不错，继续保持！';
                    analysisColor = '#2ecc71';
                } else {
                    analysisText = '还有提升空间，再练练吧！';
                    analysisColor = '#e74c3c';
                }
            } else if (size === 4) {
                if (totalTime < 10) {
                    analysisText = '反应敏捷，表现出色！';
                    analysisColor = '#f1c40f';
                } else if (totalTime < 20) {
                    analysisText = '表现良好，继续加油！';
                    analysisColor = '#2ecc71';
                } else {
                    analysisText = '可以多练习提高反应速度。';
                    analysisColor = '#e74c3c';
                }
            } else if (size === 5) {
                if (totalTime < 20) {
                    analysisText = '反应超强，令人惊叹！';
                    analysisColor = '#f1c40f';
                } else if (totalTime < 35) {
                    analysisText = '表现不错，持续进步！';
                    analysisColor = '#2ecc71';
                } else {
                    analysisText = '需要加强训练哦。';
                    analysisColor = '#e74c3c';
                }
            } else if (size === 6) {
                if (totalTime < 30) {
                    analysisText = '反应神级，无人能敌！';
                    analysisColor = '#f1c40f';
                } else if (totalTime < 50) {
                    analysisText = '表现优秀，继续努力！';
                    analysisColor = '#2ecc71';
                } else {
                    analysisText = '还有很大的提升空间。';
                    analysisColor = '#e74c3c';
                }
            }

            resultAnalysisEl.innerText = analysisText;
            resultAnalysisEl.style.backgroundColor = analysisColor;

            // 保存反应测试结果
            const scores = JSON.parse(localStorage.getItem(`${currentTestType}TestScores`)) || [];
            scores.push(totalTime);
            localStorage.setItem(`${currentTestType}TestScores`, JSON.stringify(scores));
        }

        function setNextQuestion() {
            resetState();
            if (currentQuestionIndex < shuffledQuestions.length) {
                showQuestion(shuffledQuestions[currentQuestionIndex]);
                updateProgress();
            } else {
                showResult();
            }
        }

        function showQuestion(question) {
            questionTextEl.innerText = question.question;
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.innerText = option;
                button.classList.add('btn', 'answer-btn');
                button.addEventListener('click', () => selectAnswer(button, question.answer));
                answerButtonsEl.appendChild(button);
            });
        }

        function resetState() {
            while (answerButtonsEl.firstChild) {
                answerButtonsEl.removeChild(answerButtonsEl.firstChild);
            }
        }

        function selectAnswer(selectedButton, correctAnswer) {
            const isCorrect = selectedButton.innerText === correctAnswer;
            if (isCorrect) { score += 10; }

            Array.from(answerButtonsEl.children).forEach(button => {
                button.classList.add('disabled');
                if (button.innerText === correctAnswer) { button.classList.add('correct'); }
            });

            if (!isCorrect) { selectedButton.classList.add('incorrect'); }

            setTimeout(() => {
                currentQuestionIndex++;
                setNextQuestion();
            }, 1500);
        }

        function updateProgress() {
            const progressPercentage = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
            questionCounterEl.innerText = `问题 ${currentQuestionIndex + 1} / ${shuffledQuestions.length}`;
        }

        function showResult() {
            quizContainer.classList.add('hide');
            resultContainer.classList.remove('hide');

            // 显示常规测试结果
            testSpecificResultEl.innerHTML = `<h2>你的得分：<span id="score-text">${score}</span> / 100</h2>`;

            const scores = JSON.parse(localStorage.getItem(`${currentTestType}TestScores`)) || [];
            const highScore = scores.length > 0 ? Math.max(...scores) : 0;

            let analysisText, analysisColor;

            if (scores.length === 0) {
                analysisText = `这是你完成 ${currentTestType} 测试后的首次测试。它将成为你衡量进步的基准！`;
                analysisColor = "#3498db";
            } else {
                const lastScore = scores[scores.length - 1];
                if (score > highScore) {
                    analysisText = `专注的力量！你打破了 ${currentTestType} 测试的个人纪录，思维敏锐度达到了新的高度！`;
                    analysisColor = "#f1c40f";
                } else if (score > lastScore) {
                    analysisText = `效果显著！经过专注，你在 ${currentTestType} 测试中的表现比上次更出色了。继续保持！`;
                    analysisColor = '#2ecc71';
                } else if (score === lastScore) {
                    analysisText = `表现稳定。持续的专注会在 ${currentTestType} 测试中带来长期的改变。加油！`;
                    analysisColor = "#e67e22";
                } else {
                    analysisText = `这次在 ${currentTestType} 测试中可能有点累了。休息一下，下次专注后状态会更好！`;
                    analysisColor = '#e74c3c';
                }
            }

            resultAnalysisEl.innerText = analysisText;
            resultAnalysisEl.style.backgroundColor = analysisColor;

            scores.push(score);
            localStorage.setItem(`${currentTestType}TestScores`, JSON.stringify(scores));
        }

        // 色彩敏感测试相关函数
        function generateColorQuestions() {
            const questions = [];
            for (let i = 0; i < 10; i++) {
                // 随机选择一个颜色词
                const colorWord = colorNames[Math.floor(Math.random() * colorNames.length)];

                // 确保显示的颜色和词不同
                let displayColor;
                do {
                    displayColor = colorNames[Math.floor(Math.random() * colorNames.length)];
                } while (displayColor === colorWord);

                // 生成选项，确保包含正确答案
                let options = [colorWord];
                while (options.length < 4) {
                    const randomColor = colorNames[Math.floor(Math.random() * colorNames.length)];
                    if (!options.includes(randomColor)) {
                        options.push(randomColor);
                    }
                }

                // 打乱选项顺序
                options.sort(() => Math.random() - 0.5);

                questions.push({
                    word: colorWord,
                    displayColor: displayColor,
                    options: options,
                    answer: colorWord
                });
            }
            return questions;
        }

        function startColorTest(difficulty) {
            colorDifficultyContainer.classList.add('hide');
            colorTestContainer.classList.remove('hide');
            currentTestType = 'color-sensitivity';
            colorDifficulty = difficulty;
            colorQuestions = generateColorQuestions();
            currentColorQuestionIndex = 0;
            colorScore = 0;

            setNextColorQuestion();
        }

        function setNextColorQuestion() {
            if (currentColorQuestionIndex < colorQuestions.length) {
                const question = colorQuestions[currentColorQuestionIndex];
                colorWordEl.innerText = question.word;
                colorWordEl.style.color = colorHex[question.displayColor];

                // 更新进度条
                const progressPercentage = ((currentColorQuestionIndex + 1) / colorQuestions.length) * 100;
                colorProgressBar.style.width = `${progressPercentage}%`;
                colorQuestionCounterEl.innerText = `问题 ${currentColorQuestionIndex + 1} / ${colorQuestions.length}`;

                // 清空选项
                colorOptionsEl.innerHTML = '';

                // 添加选项按钮
                question.options.forEach(option => {
                    const button = document.createElement('button');
                    button.innerText = option;
                    button.classList.add('color-option');
                    button.style.backgroundColor = colorHex[option];
                    button.addEventListener('click', () => selectColorAnswer(button, question.answer));
                    colorOptionsEl.appendChild(button);
                });

                // 设置计时器
                colorTimer = difficultyTimeLimit[colorDifficulty];
                colorTimerEl.innerText = colorTimer.toFixed(2);

                // 清除之前的计时器并启动新的计时器
                clearInterval(colorTimerInterval);
                colorTimerInterval = setInterval(updateColorTimer, 10);
            } else {
                showColorResult();
            }
        }

        function updateColorTimer() {
            colorTimer -= 0.01;
            colorTimerEl.innerText = colorTimer.toFixed(2);

            if (colorTimer <= 0) {
                clearInterval(colorTimerInterval);
                // 时间到，自动选择并继续
                selectColorAnswer(null, null);
            }
        }

        function selectColorAnswer(selectedButton, correctAnswer) {
            clearInterval(colorTimerInterval);

            // 禁用所有选项
            Array.from(colorOptionsEl.children).forEach(button => {
                button.disabled = true;
            });

            // 检查是否回答正确
            const isCorrect = selectedButton && selectedButton.innerText === correctAnswer;
            if (isCorrect) {
                colorScore++;
                if (selectedButton) selectedButton.classList.add('correct');
            } else {
                // 显示正确答案
                Array.from(colorOptionsEl.children).forEach(button => {
                    if (button.innerText === correctAnswer) {
                        button.classList.add('correct');
                    }
                });
                if (selectedButton) selectedButton.classList.add('incorrect');
            }

            // 2秒后进入下一题
            setTimeout(() => {
                currentColorQuestionIndex++;
                setNextColorQuestion();
            }, 1500);
        }

        function showColorResult() {
            colorTestContainer.classList.add('hide');
            resultContainer.classList.remove('hide');

            // 显示色彩敏感测试结果
            testSpecificResultEl.innerHTML = `<h2>色彩敏感测试结果</h2><p>你的得分：<strong>${colorScore}</strong> / 10</p>`;

            let analysisText, analysisColor;

            if (colorScore >= 9) {
                analysisText = '你的色彩感知能力和反应速度惊人！斯特鲁普效应几乎对你没有影响，你的注意力和色彩敏感度达到了专业水平！';
                analysisColor = '#f1c40f';
            } else if (colorScore >= 7) {
                analysisText = '你的色彩感知能力和反应速度很好！斯特鲁普效应对你的影响较小，你的注意力和色彩敏感度处于优秀水平！';
                analysisColor = '#2ecc71';
            } else if (colorScore >= 5) {
                analysisText = '你的色彩感知能力和反应速度一般。斯特鲁普效应会对你产生一定影响，通过练习可以提高你的注意力和色彩敏感度！';
                analysisColor = '#e67e22';
            } else {
                analysisText = '斯特鲁普效应明显影响了你的反应速度。不要担心，这是正常现象。通过持续练习，你可以显著提高你的注意力和色彩敏感度！';
                analysisColor = '#e74c3c';
            }

            resultAnalysisEl.innerText = analysisText;
            resultAnalysisEl.style.backgroundColor = analysisColor;

            const scores = JSON.parse(localStorage.getItem(`${currentTestType}TestScores`)) || [];
            scores.push(colorScore);
            localStorage.setItem(`${currentTestType}TestScores`, JSON.stringify(scores));
        }

        // 目标跟踪测试相关函数
        function initMot() {
            motField.innerHTML = '';
            balls = [];
            targetBalls = [];
            selectedBalls = [];
            motAnswerBtn.classList.add('hide');

            // 创建10个小球
            for (let i = 0; i < 10; i++) {
                const ball = document.createElement('div');
                ball.classList.add('ball');
                ball.style.left = Math.random() * (motField.offsetWidth - 20) + 'px';
                ball.style.top = Math.random() * (motField.offsetHeight - 20) + 'px';
                motField.appendChild(ball);
                balls.push({
                    element: ball,
                    x: parseFloat(ball.style.left),
                    y: parseFloat(ball.style.top),
                    dx: (Math.random() - 0.5) * 2,
                    dy: (Math.random() - 0.5) * 2
                });
            }

            // 随机选择3个目标小球
            const indices = [];
            while (indices.length < 3) {
                const index = Math.floor(Math.random() * 10);
                if (!indices.includes(index)) {
                    indices.push(index);
                    targetBalls.push(balls[index]);
                    balls[index].element.style.backgroundColor = '#f1c40f'; // 使用高亮颜色
                }
            }

            motStartBtn.disabled = false;
            motStartBtn.innerText = '开始';
            motStartBtn.addEventListener('click', startMot);
        }

        function startMot() {
            motStartBtn.disabled = true;
            motStartBtn.innerText = '移动中...';

            // 隐藏目标高亮
            targetBalls.forEach(ball => {
                ball.element.style.backgroundColor = '#e94560'; // 使用常规颜色
            });

            // 开始移动小球
            motInterval = setInterval(moveBalls, 10);

            // 移动5秒后停止
            setTimeout(() => {
                clearInterval(motInterval);
                motAnswerBtn.classList.remove('hide');
                motStartBtn.innerText = '重新开始';
                motStartBtn.disabled = false;
                motStartBtn.removeEventListener('click', startMot);
                motStartBtn.addEventListener('click', initMot);

                // 添加小球点击事件
                balls.forEach(ball => {
                    ball.element.addEventListener('click', () => {
                        if (!selectedBalls.includes(ball)) {
                            selectedBalls.push(ball);
                            ball.element.style.backgroundColor = '#3498db'; // 选中颜色
                        } else {
                            const index = selectedBalls.indexOf(ball);
                            selectedBalls.splice(index, 1);
                            ball.element.style.backgroundColor = '#e94560'; // 常规颜色
                        }
                    });
                });

                motAnswerBtn.addEventListener('click', checkMotAnswer);
            }, 5000);
        }

        function moveBalls() {
            balls.forEach(ball => {
                ball.x += ball.dx;
                ball.y += ball.dy;

                if (ball.x < 0 || ball.x > motField.offsetWidth - 20) {
                    ball.dx = -ball.dx;
                }
                if (ball.y < 0 || ball.y > motField.offsetHeight - 20) {
                    ball.dy = -ball.dy;
                }

                ball.element.style.left = ball.x + 'px';
                ball.element.style.top = ball.y + 'px';
            });
        }

        function checkMotAnswer() {
            motAnswerBtn.disabled = true;

            let correctCount = 0;
            targetBalls.forEach(target => {
                if (selectedBalls.includes(target)) {
                    correctCount++;
                    target.element.style.backgroundColor = '#2ecc71'; // 正确颜色
                } else {
                    target.element.style.backgroundColor = '#e74c3c'; // 错误颜色
                }
            });

            selectedBalls.forEach(selected => {
                if (!targetBalls.includes(selected)) {
                    selected.element.style.backgroundColor = '#e74c3c'; // 错误颜色
                }
            });

            motContainer.classList.add('hide');
            resultContainer.classList.remove('hide');

            // 显示目标跟踪测试结果
            testSpecificResultEl.innerHTML = `<h2>目标跟踪测试结果</h2><p>你正确选出了 <strong>${correctCount}</strong> 个目标。</p>`;

            let analysisText, analysisColor;
            if (correctCount === 3) {
                analysisText = '你的专注度和目标跟踪能力非常出色！能够准确地在多个移动目标中识别出指定目标。';
                analysisColor = '#f1c40f';
            } else if (correctCount >= 2) {
                analysisText = '你的专注度不错，能识别出大部分目标。继续保持练习可以进一步提高。';
                analysisColor = '#2ecc71';
            } else if (correctCount >= 1) {
                analysisText = '你能识别出部分目标，但还有提升空间。多进行类似练习可以增强专注度。';
                analysisColor = '#e67e22';
            } else {
                analysisText = '这次测试中你可能没有很好地集中注意力。不要灰心，通过持续练习可以提高专注度。';
                analysisColor = '#e74c3c';
            }

            resultAnalysisEl.innerText = analysisText;
            resultAnalysisEl.style.backgroundColor = analysisColor;

            const scores = JSON.parse(localStorage.getItem(`${currentTestType}TestScores`)) || [];
            scores.push(correctCount);
            localStorage.setItem(`${currentTestType}TestScores`, JSON.stringify(scores));
        }

        // 事件监听器
        reactionTestBtn.addEventListener('click', () => startGame('reaction'));
        iqTestBtn.addEventListener('click', () => startGame('iq'));
        focusTestBtn.addEventListener('click', () => startGame('focus'));
        colorSensitivityTestBtn.addEventListener('click', () => startGame('color-sensitivity'));
        eqTestBtn.addEventListener('click', () => startGame('eq'));
        restartBtn.addEventListener('click', () => {
            if (currentTestType === 'reaction') {
                reactionDifficultyContainer.classList.remove('hide');
                resultContainer.classList.add('hide');
            } else if (currentTestType === 'color-sensitivity') {
                colorDifficultyContainer.classList.remove('hide');
                resultContainer.classList.add('hide');
            } else if (currentTestType === 'focus') {
                motContainer.classList.remove('hide');
                resultContainer.classList.add('hide');
                initMot();
            } else {
                startGame(currentTestType);
            }
        });
        backBtn.addEventListener('click', () => {
            testCenterContainer.classList.remove('hide');
            resultContainer.classList.add('hide');
            quizContainer.classList.add('hide');
            shulteTestContainer.classList.add('hide');
            reactionDifficultyContainer.classList.add('hide');
            colorTestContainer.classList.add('hide');
            colorDifficultyContainer.classList.add('hide');
            motContainer.classList.add('hide');
        });
        backToMainBtn.addEventListener('click', () => {
            window.location.href = '/';
        });
        backToTestCenterBtn.addEventListener('click', () => {
            reactionDifficultyContainer.classList.add('hide');
            testCenterContainer.classList.remove('hide');
        });
        shulteBackToDifficultyBtn.addEventListener('click', () => {
            shulteTestContainer.classList.add('hide');
            reactionDifficultyContainer.classList.remove('hide');
            clearInterval(shulteInterval);
        });
        document.getElementById('3x3-btn').addEventListener('click', () => startShulteTest(3));
        document.getElementById('4x4-btn').addEventListener('click', () => startShulteTest(4));
        document.getElementById('5x5-btn').addEventListener('click', () => startShulteTest(5));
        document.getElementById('6x6-btn').addEventListener('click', () => startShulteTest(6));

        // 色彩敏感测试事件监听器
        colorEasyBtn.addEventListener('click', () => startColorTest('easy'));
        colorMediumBtn.addEventListener('click', () => startColorTest('medium'));
        colorHardBtn.addEventListener('click', () => startColorTest('hard'));
        colorBackToDifficultyBtn.addEventListener('click', () => {
            colorTestContainer.classList.add('hide');
            colorDifficultyContainer.classList.remove('hide');
            clearInterval(colorTimerInterval);
        });
        colorBackToTestCenterBtn.addEventListener('click', () => {
            colorDifficultyContainer.classList.add('hide');
            testCenterContainer.classList.remove('hide');
        });

        // 目标跟踪测试事件监听器
        motBackToTestCenterBtn.addEventListener('click', () => {
            motContainer.classList.add('hide');
            testCenterContainer.classList.remove('hide');
            clearInterval(motInterval);
        });

        // 新增返回按钮事件监听器
        document.getElementById('quiz-back-btn').addEventListener('click', () => {
            quizContainer.classList.add('hide');
            testCenterContainer.classList.remove('hide');
        });
    </script>
</body>

</html>
    